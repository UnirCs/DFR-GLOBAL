-- ============================================
-- UNIR Cinema (PostgreSQL) - Esquema y datos seed
-- ============================================

BEGIN;

-- Re-ejecutable en entorno de desarrollo
DROP TABLE IF EXISTS tickets;
DROP TABLE IF EXISTS orders;
DROP TABLE IF EXISTS screenings;
DROP TABLE IF EXISTS rooms;
DROP TABLE IF EXISTS users;
DROP TABLE IF EXISTS movies;
DROP TABLE IF EXISTS cinemas;

CREATE TABLE cinemas (
                         id BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
                         city TEXT NOT NULL UNIQUE,
                         slug TEXT NOT NULL UNIQUE,
                         name TEXT NOT NULL,
                         address TEXT
);

CREATE TABLE rooms (
                       id BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
                       cinema_id BIGINT NOT NULL REFERENCES cinemas(id) ON DELETE CASCADE,
                       name TEXT NOT NULL,
                       capacity INTEGER NOT NULL CHECK (capacity > 0),
                       UNIQUE (cinema_id, name)
);

CREATE TABLE movies (
                        id INTEGER PRIMARY KEY,
                        title TEXT NOT NULL,
                        genre TEXT NOT NULL,
                        duration_text TEXT NOT NULL,
                        duration_minutes INTEGER NOT NULL CHECK (duration_minutes > 0),
                        rating_text TEXT NOT NULL,
                        rating_value NUMERIC(3,1) NOT NULL CHECK (rating_value >= 0 AND rating_value <= 10),
                        synopsis TEXT NOT NULL,
                        image TEXT NOT NULL,
                        director TEXT NOT NULL,
                        casts TEXT[] NOT NULL,
                        year INTEGER NOT NULL CHECK (year >= 1888)
    );

CREATE TABLE users (
                       id INTEGER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
                       username TEXT NOT NULL UNIQUE,
                       email TEXT NOT NULL UNIQUE,
                       role TEXT NOT NULL CHECK (role IN ('admin','manager','user')),
                       name TEXT NOT NULL,
                       password_hash TEXT NOT NULL,
                       created_at TIMESTAMPTZ NOT NULL DEFAULT NOW()
);

CREATE TABLE screenings (
                            id BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
                            cinema_id BIGINT NOT NULL REFERENCES cinemas(id) ON DELETE RESTRICT,
                            room_id BIGINT NOT NULL REFERENCES rooms(id) ON DELETE RESTRICT,
                            movie_id INTEGER NOT NULL REFERENCES movies(id) ON DELETE RESTRICT,
                            show_date DATE NOT NULL,
                            show_time TIME NOT NULL,
                            format TEXT NOT NULL CHECK (format IN ('imax','3d','hdfr','standard')),
                            base_price NUMERIC(6,2) NOT NULL CHECK (base_price >= 0),
                            created_at TIMESTAMPTZ NOT NULL DEFAULT NOW(),
    -- Evita doble reserva de sala a misma hora
                            UNIQUE (cinema_id, room_id, movie_id, show_date, show_time)
);

CREATE INDEX idx_screenings_cinema_date ON screenings (cinema_id, show_date);
CREATE INDEX idx_screenings_movie_date ON screenings (movie_id, show_date);

CREATE TABLE orders (
                        id BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
                        user_id INTEGER NOT NULL REFERENCES users(id) ON DELETE RESTRICT,
                        status TEXT NOT NULL CHECK (status IN ('pending','paid','cancelled','refunded')),
                        total_amount NUMERIC(10,2) NOT NULL CHECK (total_amount >= 0),
                        created_at TIMESTAMPTZ NOT NULL DEFAULT NOW()
);

CREATE INDEX idx_orders_user_date ON orders (user_id, created_at);

CREATE TABLE tickets (
                         id BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
                         order_id BIGINT NOT NULL REFERENCES orders(id) ON DELETE CASCADE,
                         user_id INTEGER NOT NULL REFERENCES users(id) ON DELETE RESTRICT,
                         screening_id BIGINT NOT NULL REFERENCES screenings(id) ON DELETE RESTRICT,
                         seat_label TEXT NOT NULL,
                         price_paid NUMERIC(6,2) NOT NULL CHECK (price_paid >= 0),
                         created_at TIMESTAMPTZ NOT NULL DEFAULT NOW(),
    -- Una butaca solo puede venderse una vez por sesión
                         UNIQUE (screening_id, seat_label)
);

CREATE INDEX idx_tickets_user_date ON tickets (user_id, created_at);
CREATE INDEX idx_tickets_screening ON tickets (screening_id);

-- ============================================
-- Datos seed coherentes con los mocks
-- ============================================

-- Cines (ciudades disponibles)
INSERT INTO cinemas (id, city, slug, name, address)
VALUES (1, 'Madrid', 'madrid', 'UNIR Cinema Madrid', 'Madrid, España');
INSERT INTO cinemas (id, city, slug, name, address)
VALUES (2, 'Barcelona', 'barcelona', 'UNIR Cinema Barcelona', 'Barcelona, España');
INSERT INTO cinemas (id, city, slug, name, address)
VALUES (3, 'Sevilla', 'sevilla', 'UNIR Cinema Sevilla', 'Sevilla, España');
INSERT INTO cinemas (id, city, slug, name, address)
VALUES (4, 'Valencia', 'valencia', 'UNIR Cinema Valencia', 'Valencia, España');

-- Salas
INSERT INTO rooms (id, cinema_id, name, capacity)
VALUES (1, 1, 'Sala 1', 120);
INSERT INTO rooms (id, cinema_id, name, capacity)
VALUES (2, 1, 'Sala 2', 100);
INSERT INTO rooms (id, cinema_id, name, capacity)
VALUES (3, 1, 'Sala 3', 80);
INSERT INTO rooms (id, cinema_id, name, capacity)
VALUES (4, 2, 'Sala 1', 120);
INSERT INTO rooms (id, cinema_id, name, capacity)
VALUES (5, 2, 'Sala 2', 100);
INSERT INTO rooms (id, cinema_id, name, capacity)
VALUES (6, 2, 'Sala 3', 80);
INSERT INTO rooms (id, cinema_id, name, capacity)
VALUES (7, 3, 'Sala 1', 120);
INSERT INTO rooms (id, cinema_id, name, capacity)
VALUES (8, 3, 'Sala 2', 100);
INSERT INTO rooms (id, cinema_id, name, capacity)
VALUES (9, 3, 'Sala 3', 80);
INSERT INTO rooms (id, cinema_id, name, capacity)
VALUES (10, 4, 'Sala 1', 120);
INSERT INTO rooms (id, cinema_id, name, capacity)
VALUES (11, 4, 'Sala 2', 100);
INSERT INTO rooms (id, cinema_id, name, capacity)
VALUES (12, 4, 'Sala 3', 80);

-- Películas (catálogo)
INSERT INTO movies (id, title, genre, duration_text, duration_minutes, rating_text, rating_value, synopsis, image, director, casts, year)
VALUES (1, 'Avatar: El camino del agua', 'Ciencia ficción', '192 min', 192, '7.8/10', 7.8, 'Jake Sully vive con su nueva familia formada en el planeta de Pandora. Una vez que una amenaza familiar regresa para terminar lo que se empezó anteriormente, Jake debe trabajar con Neytiri y el ejército de la raza Na''vi para proteger su planeta.', 'https://via.placeholder.com/300x400/0066cc/ffffff?text=Avatar+2', 'James Cameron', ARRAY['Sam Worthington', 'Zoe Saldana', 'Sigourney Weaver']::text[], 2022);
INSERT INTO movies (id, title, genre, duration_text, duration_minutes, rating_text, rating_value, synopsis, image, director, casts, year)
VALUES (2, 'Black Panther: Wakanda Forever', 'Acción', '161 min', 161, '7.2/10', 7.2, 'La reina Ramonda, Shuri, M''Baku, Okoye y las Dora Milaje luchan para proteger su nación de las potencias mundiales que intervienen tras la muerte del rey T''Challa.', 'https://via.placeholder.com/300x400/8B4513/ffffff?text=Black+Panther+2', 'Ryan Coogler', ARRAY['Letitia Wright', 'Angela Bassett', 'Lupita Nyong''o']::text[], 2022);
INSERT INTO movies (id, title, genre, duration_text, duration_minutes, rating_text, rating_value, synopsis, image, director, casts, year)
VALUES (3, 'Top Gun: Maverick', 'Acción', '130 min', 130, '8.5/10', 8.5, 'Después de más de 30 años de servicio como uno de los mejores aviadores de la Armada, Pete ''Maverick'' Mitchell está donde pertenece, empujando los límites como un valiente piloto de prueba.', 'https://via.placeholder.com/300x400/FF6347/ffffff?text=Top+Gun', 'Joseph Kosinski', ARRAY['Tom Cruise', 'Miles Teller', 'Jennifer Connelly']::text[], 2022);
INSERT INTO movies (id, title, genre, duration_text, duration_minutes, rating_text, rating_value, synopsis, image, director, casts, year)
VALUES (4, 'Spiderman: No Way Homeee', 'Acción', '148 min', 148, '8.4/10', 8.4, 'Peter Parker busca ayuda del Doctor Strange para que el mundo olvide que él es Spiderman, pero el hechizo sale mal y villanos de otros universos comienzan a aparecer.', 'https://via.placeholder.com/300x400/FF0000/ffffff?text=Spiderman', 'Jon Watts', ARRAY['Tom Holland', 'Zendaya', 'Benedict Cumberbatch']::text[], 2021);
INSERT INTO movies (id, title, genre, duration_text, duration_minutes, rating_text, rating_value, synopsis, image, director, casts, year)
VALUES (5, 'Doctor Strange 2', 'Fantasía', '126 min', 126, '7.0/10', 7.0, 'El Doctor Strange se adentra en el peligroso Multiverso Alternativo con la ayuda de nuevos aliados místicos y otros ya conocidos para enfrentarse a un nuevo y misterioso adversario.', 'https://via.placeholder.com/300x400/800080/ffffff?text=Dr+Strange', 'Sam Raimi', ARRAY['Benedict Cumberbatch', 'Elizabeth Olsen', 'Chiwetel Ejiofor']::text[], 2022);
INSERT INTO movies (id, title, genre, duration_text, duration_minutes, rating_text, rating_value, synopsis, image, director, casts, year)
VALUES (6, 'Thor: Love and Thunder', 'Acción', '119 min', 119, '6.8/10', 6.8, 'Thor se embarca en un viaje como nunca antes había hecho: una búsqueda de la paz interior. Pero su retiro se ve interrumpido por un asesino galáctico conocido como Gorr el Carnicero de Dioses.', 'https://via.placeholder.com/300x400/FFD700/ffffff?text=Thor', 'Taika Waititi', ARRAY['Chris Hemsworth', 'Natalie Portman', 'Christian Bale']::text[], 2022);
INSERT INTO movies (id, title, genre, duration_text, duration_minutes, rating_text, rating_value, synopsis, image, director, casts, year)
VALUES (7, 'Fast X', 'Acción', '141 min', 141, '6.9/10', 6.9, 'Dom Toretto y su familia se enfrentan a su adversario más letal: una amenaza emergente de las sombras del pasado que está alimentada por sed de venganza y está decidida a destrozar a esta familia.', 'https://via.placeholder.com/300x400/FF4500/ffffff?text=Fast+X', 'Louis Leterrier', ARRAY['Vin Diesel', 'Michelle Rodriguez', 'Tyrese Gibson']::text[], 2023);
INSERT INTO movies (id, title, genre, duration_text, duration_minutes, rating_text, rating_value, synopsis, image, director, casts, year)
VALUES (8, 'Transformers: El despertar de las bestias', 'Ciencia ficción', '127 min', 127, '7.1/10', 7.1, 'Los Autobots y Maximals se unen para luchar contra una nueva amenaza terrorista: los Terrorcons, liderados por Scourge, que buscan obtener una clave poderosa que podría destruir el universo.', 'https://via.placeholder.com/300x400/4169E1/ffffff?text=Transformers', 'Steven Caple Jr.', ARRAY['Anthony Ramos', 'Dominique Fishback', 'Peter Cullen']::text[], 2023);
INSERT INTO movies (id, title, genre, duration_text, duration_minutes, rating_text, rating_value, synopsis, image, director, casts, year)
VALUES (9, 'Indiana Jones 5', 'Aventura', '154 min', 154, '7.5/10', 7.5, 'El arqueólogo Indiana Jones se encuentra en una carrera contra el tiempo para recuperar un artefacto legendario que puede cambiar el curso de la historia.', 'https://via.placeholder.com/300x400/8B4513/ffffff?text=Indiana+Jones', 'James Mangold', ARRAY['Harrison Ford', 'Phoebe Waller-Bridge', 'Antonio Banderas']::text[], 2023);
INSERT INTO movies (id, title, genre, duration_text, duration_minutes, rating_text, rating_value, synopsis, image, director, casts, year)
VALUES (10, 'Jurassic World: Dominion', 'Aventura', '147 min', 147, '7.1/10', 7.1, 'Cuatro años después de la destrucción de Isla Nublar, los dinosaurios ahora viven y cazan junto a los humanos en todo el mundo. Este frágil equilibrio remodelará el futuro.', 'https://via.placeholder.com/300x400/228B22/ffffff?text=Jurassic', 'Colin Trevorrow', ARRAY['Chris Pratt', 'Bryce Dallas Howard', 'Laura Dern']::text[], 2022);
INSERT INTO movies (id, title, genre, duration_text, duration_minutes, rating_text, rating_value, synopsis, image, director, casts, year)
VALUES (11, 'Minions: The Rise of Gru', 'Animación', '87 min', 87, '7.3/10', 7.3, 'En los años 70, Gru crece siendo un gran fan de un grupo de supervillanos conocido como Vicious 6. Cuando los Vicious 6 despiden a su líder, Gru se presenta para unirse a ellos.', 'https://via.placeholder.com/300x400/FFFF00/000000?text=Minions', 'Kyle Balda', ARRAY['Steve Carell', 'Pierre Coffin', 'Alan Arkin']::text[], 2022);
INSERT INTO movies (id, title, genre, duration_text, duration_minutes, rating_text, rating_value, synopsis, image, director, casts, year)
VALUES (12, 'Lightyear', 'Animación', '105 min', 105, '7.2/10', 7.2, 'La historia del origen definitiva de Buzz Lightyear, el héroe que inspiró el juguete, siguiendo al legendario Space Ranger después de que él y su comandante queden varados en un planeta hostil.', 'https://via.placeholder.com/300x400/87CEEB/ffffff?text=Lightyear', 'Angus MacLane', ARRAY['Chris Evans', 'Keke Palmer', 'Peter Sohn']::text[], 2022);

-- Usuarios (para autenticación demo)
-- Nota didáctica: en producción aquí iría un hash (bcrypt/argon2), no la contraseña en claro.
INSERT INTO users (id, username, email, role, name, password_hash)
VALUES (1, 'admin', 'admin@unircinema.com', 'admin', 'Administrador', 'admin123');
INSERT INTO users (id, username, email, role, name, password_hash)
VALUES (2, 'user', 'user1@unircinema.com', 'user', 'Usuario Demo', 'user123');
INSERT INTO users (id, username, email, role, name, password_hash)
VALUES (3, 'manager', 'manager@unircinema.com', 'manager', 'Manager Cinema', 'manager123');
INSERT INTO users (id, username, email, role, name, password_hash)
VALUES (4, 'guest', 'guest@unircinema.com', 'user', 'Invitado', 'guest123');

-- Sesiones/Proyecciones para un día concreto (2026-01-11)
-- Precios base por formato: imax 12.50, 3d 11.00, hdfr 10.50, standard 9.50

-- Madrid
INSERT INTO screenings (id, cinema_id, room_id, movie_id, show_date, show_time, format, base_price)
VALUES (1, 1, 1, 4, DATE '2026-01-11', TIME '17:30', 'imax', 12.50);
INSERT INTO screenings (id, cinema_id, room_id, movie_id, show_date, show_time, format, base_price)
VALUES (2, 1, 2, 4, DATE '2026-01-11', TIME '19:45', 'imax', 12.50);
INSERT INTO screenings (id, cinema_id, room_id, movie_id, show_date, show_time, format, base_price)
VALUES (3, 1, 3, 4, DATE '2026-01-11', TIME '22:30', 'imax', 12.50);

INSERT INTO screenings (id, cinema_id, room_id, movie_id, show_date, show_time, format, base_price)
VALUES (4, 1, 1, 5, DATE '2026-01-11', TIME '15:00', '3d', 11.00);
INSERT INTO screenings (id, cinema_id, room_id, movie_id, show_date, show_time, format, base_price)
VALUES (5, 1, 2, 5, DATE '2026-01-11', TIME '18:00', '3d', 11.00);
INSERT INTO screenings (id, cinema_id, room_id, movie_id, show_date, show_time, format, base_price)
VALUES (6, 1, 3, 5, DATE '2026-01-11', TIME '21:30', '3d', 11.00);

INSERT INTO screenings (id, cinema_id, room_id, movie_id, show_date, show_time, format, base_price)
VALUES (7, 1, 1, 6, DATE '2026-01-11', TIME '16:45', 'standard', 9.50);
INSERT INTO screenings (id, cinema_id, room_id, movie_id, show_date, show_time, format, base_price)
VALUES (8, 1, 2, 6, DATE '2026-01-11', TIME '19:15', 'standard', 9.50);
INSERT INTO screenings (id, cinema_id, room_id, movie_id, show_date, show_time, format, base_price)
VALUES (9, 1, 3, 6, DATE '2026-01-11', TIME '22:00', 'standard', 9.50);

INSERT INTO screenings (id, cinema_id, room_id, movie_id, show_date, show_time, format, base_price)
VALUES (10, 1, 1, 4, DATE '2026-01-11', TIME '16:30', 'imax', 12.50);

-- Barcelona
INSERT INTO screenings (id, cinema_id, room_id, movie_id, show_date, show_time, format, base_price)
VALUES (13, 2, 4, 1, DATE '2026-01-11', TIME '16:00', '3d', 11.00);
INSERT INTO screenings (id, cinema_id, room_id, movie_id, show_date, show_time, format, base_price)
VALUES (14, 2, 5, 1, DATE '2026-01-11', TIME '19:30', '3d', 11.00);
INSERT INTO screenings (id, cinema_id, room_id, movie_id, show_date, show_time, format, base_price)
VALUES (15, 2, 6, 1, DATE '2026-01-11', TIME '22:45', '3d', 11.00);

INSERT INTO screenings (id, cinema_id, room_id, movie_id, show_date, show_time, format, base_price)
VALUES (16, 2, 4, 2, DATE '2026-01-11', TIME '15:30', 'imax', 12.50);
INSERT INTO screenings (id, cinema_id, room_id, movie_id, show_date, show_time, format, base_price)
VALUES (17, 2, 5, 2, DATE '2026-01-11', TIME '18:15', 'imax', 12.50);
INSERT INTO screenings (id, cinema_id, room_id, movie_id, show_date, show_time, format, base_price)
VALUES (18, 2, 6, 2, DATE '2026-01-11', TIME '21:00', 'imax', 12.50);

INSERT INTO screenings (id, cinema_id, room_id, movie_id, show_date, show_time, format, base_price)
VALUES (19, 2, 4, 3, DATE '2026-01-11', TIME '17:00', 'hdfr', 10.50);
INSERT INTO screenings (id, cinema_id, room_id, movie_id, show_date, show_time, format, base_price)
VALUES (20, 2, 5, 3, DATE '2026-01-11', TIME '20:00', 'hdfr', 10.50);
INSERT INTO screenings (id, cinema_id, room_id, movie_id, show_date, show_time, format, base_price)
VALUES (21, 2, 6, 3, DATE '2026-01-11', TIME '23:00', 'hdfr', 10.50);

-- Sevilla
INSERT INTO screenings (id, cinema_id, room_id, movie_id, show_date, show_time, format, base_price)
VALUES (22, 3, 7, 7, DATE '2026-01-11', TIME '16:15', 'hdfr', 10.50);
INSERT INTO screenings (id, cinema_id, room_id, movie_id, show_date, show_time, format, base_price)
VALUES (23, 3, 8, 7, DATE '2026-01-11', TIME '19:00', 'hdfr', 10.50);
INSERT INTO screenings (id, cinema_id, room_id, movie_id, show_date, show_time, format, base_price)
VALUES (24, 3, 9, 7, DATE '2026-01-11', TIME '22:15', 'hdfr', 10.50);

INSERT INTO screenings (id, cinema_id, room_id, movie_id, show_date, show_time, format, base_price)
VALUES (25, 3, 7, 8, DATE '2026-01-11', TIME '15:45', 'imax', 12.50);
INSERT INTO screenings (id, cinema_id, room_id, movie_id, show_date, show_time, format, base_price)
VALUES (26, 3, 8, 8, DATE '2026-01-11', TIME '18:30', 'imax', 12.50);
INSERT INTO screenings (id, cinema_id, room_id, movie_id, show_date, show_time, format, base_price)
VALUES (27, 3, 9, 8, DATE '2026-01-11', TIME '21:45', 'imax', 12.50);

INSERT INTO screenings (id, cinema_id, room_id, movie_id, show_date, show_time, format, base_price)
VALUES (28, 3, 7, 9, DATE '2026-01-11', TIME '17:30', 'standard', 9.50);
INSERT INTO screenings (id, cinema_id, room_id, movie_id, show_date, show_time, format, base_price)
VALUES (29, 3, 8, 9, DATE '2026-01-11', TIME '20:30', 'standard', 9.50);
INSERT INTO screenings (id, cinema_id, room_id, movie_id, show_date, show_time, format, base_price)
VALUES (30, 3, 9, 9, DATE '2026-01-11', TIME '23:15', 'standard', 9.50);

-- Valencia
INSERT INTO screenings (id, cinema_id, room_id, movie_id, show_date, show_time, format, base_price)
VALUES (31, 4, 10, 10, DATE '2026-01-11', TIME '15:45', '3d', 11.00);
INSERT INTO screenings (id, cinema_id, room_id, movie_id, show_date, show_time, format, base_price)
VALUES (32, 4, 11, 10, DATE '2026-01-11', TIME '18:30', '3d', 11.00);
INSERT INTO screenings (id, cinema_id, room_id, movie_id, show_date, show_time, format, base_price)
VALUES (33, 4, 12, 10, DATE '2026-01-11', TIME '21:45', '3d', 11.00);

INSERT INTO screenings (id, cinema_id, room_id, movie_id, show_date, show_time, format, base_price)
VALUES (34, 4, 10, 11, DATE '2026-01-11', TIME '16:00', 'standard', 9.50);
INSERT INTO screenings (id, cinema_id, room_id, movie_id, show_date, show_time, format, base_price)
VALUES (35, 4, 11, 11, DATE '2026-01-11', TIME '18:00', 'standard', 9.50);
INSERT INTO screenings (id, cinema_id, room_id, movie_id, show_date, show_time, format, base_price)
VALUES (36, 4, 12, 11, DATE '2026-01-11', TIME '20:00', 'standard', 9.50);

INSERT INTO screenings (id, cinema_id, room_id, movie_id, show_date, show_time, format, base_price)
VALUES (37, 4, 10, 12, DATE '2026-01-11', TIME '15:30', 'imax', 12.50);
INSERT INTO screenings (id, cinema_id, room_id, movie_id, show_date, show_time, format, base_price)
VALUES (38, 4, 11, 12, DATE '2026-01-11', TIME '17:30', 'imax', 12.50);
INSERT INTO screenings (id, cinema_id, room_id, movie_id, show_date, show_time, format, base_price)
VALUES (39, 4, 12, 12, DATE '2026-01-11', TIME '19:30', 'imax', 12.50);

-- Pedidos y entradas (ejemplo funcional)
INSERT INTO orders (id, user_id, status, total_amount, created_at)
VALUES (1, 2, 'paid', 36.00, '2026-01-11T10:00:00Z'::timestamptz);
INSERT INTO orders (id, user_id, status, total_amount, created_at)
VALUES (2, 1, 'paid', 12.50, '2026-01-11T11:00:00Z'::timestamptz);

INSERT INTO tickets (id, order_id, user_id, screening_id, price_paid, seat_label, created_at)
VALUES (1, 1, 2, 2, 12.50, 'A1', '2026-01-11T10:00:00Z'::timestamptz);
INSERT INTO tickets (id, order_id, user_id, screening_id, price_paid, seat_label, created_at)
VALUES (2, 1, 2, 2, 12.50, 'A2', '2026-01-11T10:00:00Z'::timestamptz);
INSERT INTO tickets (id, order_id, user_id, screening_id, price_paid, seat_label, created_at)
VALUES (3, 1, 2, 5, 11.00, 'B5', '2026-01-11T10:00:00Z'::timestamptz);

INSERT INTO tickets (id, order_id, user_id, screening_id, price_paid, seat_label, created_at)
VALUES (4, 2, 1, 10, 12.50, 'C3', '2026-01-11T11:00:00Z'::timestamptz);

-- ============================================
-- Resetear secuencias IDENTITY después de insertar datos seed
-- Esto evita conflictos de clave duplicada al insertar nuevos registros
-- ============================================
SELECT setval(pg_get_serial_sequence('cinemas', 'id'), COALESCE((SELECT MAX(id) FROM cinemas), 0) + 1, false);
SELECT setval(pg_get_serial_sequence('rooms', 'id'), COALESCE((SELECT MAX(id) FROM rooms), 0) + 1, false);
SELECT setval(pg_get_serial_sequence('screenings', 'id'), COALESCE((SELECT MAX(id) FROM screenings), 0) + 1, false);
SELECT setval(pg_get_serial_sequence('users', 'id'), COALESCE((SELECT MAX(id) FROM users), 0) + 1, false);
SELECT setval(pg_get_serial_sequence('orders', 'id'), COALESCE((SELECT MAX(id) FROM orders), 0) + 1, false);
SELECT setval(pg_get_serial_sequence('tickets', 'id'), COALESCE((SELECT MAX(id) FROM tickets), 0) + 1, false);

COMMIT;
